<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="referrer" content="no-referrer">
  <title>COIN SLOT ‚Ä¢ Candy UI (PNG)</title>

  <style>
    /* ===== Candy / Glossy Theme ===== */
    :root{
      --bgA:#1b0530;
      --bgB:#2b0a47;

      --panelA: rgba(255,255,255,.08);
      --panelB: rgba(255,255,255,.04);

      --frame1:#ffb2e4;
      --frame2:#7fe9ff;
      --frame3:#ffd36b;

      --text:#fff4fb;
      --muted: rgba(255,255,255,.72);

      --gold:#ffd166;
      --pink:#ff72c6;
      --cyan:#7bdff2;
      --good:#51cf66;

      --shadow: 0 22px 60px rgba(0,0,0,.60);
      --radius: 26px;
      --stroke2: rgba(255,255,255,.12);
    }

    *{box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;}
    html,body{
      height:100%; margin:0;
      background:
        radial-gradient(1200px 760px at 18% 12%, #3a0a57 0%, #1a062e 55%, #0b0416 100%);
      color:var(--text);
      overflow:hidden;
    }

    .safe{
      padding-top: max(12px, env(safe-area-inset-top));
      padding-right: max(12px, env(safe-area-inset-right));
      padding-bottom: max(12px, env(safe-area-inset-bottom));
      padding-left: max(12px, env(safe-area-inset-left));
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* card frame */
    .card{
      width:min(430px, 96vw);
      border-radius: var(--radius);
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(255,140,210,.25), rgba(0,0,0,0) 55%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
    }

    /* sparkles layer */
    .card::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.9), rgba(255,255,255,0) 60%),
        radial-gradient(2px 2px at 34% 26%, rgba(255,255,255,.7), rgba(255,255,255,0) 60%),
        radial-gradient(1.8px 1.8px at 64% 14%, rgba(255,255,255,.85), rgba(255,255,255,0) 60%),
        radial-gradient(2.2px 2.2px at 78% 32%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%),
        radial-gradient(1.6px 1.6px at 22% 60%, rgba(255,255,255,.75), rgba(255,255,255,0) 60%),
        radial-gradient(2.4px 2.4px at 86% 64%, rgba(255,255,255,.9), rgba(255,255,255,0) 60%),
        radial-gradient(1.6px 1.6px at 52% 76%, rgba(255,255,255,.65), rgba(255,255,255,0) 60%),
        radial-gradient(2px 2px at 14% 86%, rgba(255,255,255,.8), rgba(255,255,255,0) 60%);
      opacity:.55;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    /* glossy frame border */
    .card::after{
      content:"";
      position:absolute; inset:8px;
      border-radius: calc(var(--radius) - 8px);
      border: 2px solid rgba(255,255,255,.18);
      box-shadow:
        inset 0 0 0 2px rgba(255,178,228,.18),
        inset 0 0 0 4px rgba(127,233,255,.10);
      pointer-events:none;
    }

    .topbar{
      padding:12px 14px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      background: linear-gradient(180deg, rgba(255,170,220,.35), rgba(255,255,255,.06));
      border-bottom: 1px solid rgba(255,255,255,.10);
      position:relative;
      z-index:2;
    }
    .brand{display:flex; flex-direction:column; gap:2px; line-height:1.05;}
    .brand b{
      letter-spacing:.6px;
      font-size:14px;
      font-weight:1100;
      text-shadow: 0 10px 18px rgba(0,0,0,.25);
    }
    .brand small{color:var(--muted); font-weight:800; font-size:12px;}

    .hud{display:flex; gap:8px; align-items:center;}
    .pill{
      padding:8px 10px; border-radius:999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 10px 16px rgba(255,255,255,.06);
      font-weight:1000;
      display:flex; gap:8px; align-items:center;
      white-space:nowrap;
      font-size:13px;
    }
    .pill .coin{filter: drop-shadow(0 2px 8px rgba(255,209,102,.35));}

    .iconBtn{
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      color:var(--text);
      display:grid; place-items:center;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease, filter .08s ease;
      box-shadow: inset 0 10px 18px rgba(255,255,255,.06);
    }
    .iconBtn:active{transform: translateY(1px) scale(.99); filter: brightness(.97);}

    .stage{padding:12px 14px 14px; position:relative; z-index:2;}

    .hook{
      text-align:center;
      padding:10px 12px;
      border-radius:16px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.10));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: inset 0 10px 22px rgba(255,255,255,.06);
      margin-bottom:10px;
      font-weight:1100;
      letter-spacing:.2px;
    }
    .hook span{color:var(--gold);}

    .meterWrap{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin: 10px 0 10px;
    }
    .meterLabel{color:rgba(255,255,255,.80); font-weight:1000; font-size:12px; display:flex; gap:8px; align-items:center;}
    .meter{
      flex:1;
      height:12px;
      border-radius:999px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
      position:relative;
      box-shadow: inset 0 10px 18px rgba(255,255,255,.05);
    }
    .meterFill{
      height:100%;
      width: 12%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(255,210,105,.95), rgba(255,114,198,.95), rgba(123,223,242,.95));
      box-shadow: 0 14px 30px rgba(255,114,198,.16);
      transition: width .35s ease;
    }
    .meterPct{
      min-width:44px;
      text-align:right;
      font-weight:1100;
      color:rgba(255,255,255,.86);
      font-size:12px;
    }

    .slot{
      border-radius:22px;
      background:
        radial-gradient(900px 260px at 50% 0%, rgba(255,255,255,.09), rgba(0,0,0,.22)),
        rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      padding:12px;
      position:relative;
      overflow:hidden;
      box-shadow:
        inset 0 14px 26px rgba(255,255,255,.05),
        0 18px 42px rgba(0,0,0,.35);
    }

    .reels{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      position:relative;
      margin-bottom:10px;
    }

    .reel{
      height:96px;
      border-radius:18px;
      background:
        radial-gradient(220px 140px at 50% 0%, rgba(255,255,255,.14), rgba(0,0,0,0) 55%),
        rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      position:relative;
      overflow:hidden;
      box-shadow:
        inset 0 16px 24px rgba(0,0,0,.25),
        0 10px 20px rgba(0,0,0,.22);
    }
    .reel::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,0), rgba(255,255,255,.10));
      pointer-events:none;
    }

    .strip{
      position:absolute;
      left:0; right:0;
      top:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding:10px 0;
      transform: translateY(0);
      will-change: transform;
    }

    .sym{
      width:100%;
      height:60px;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .sym img{
      width:52px;
      height:52px;
      object-fit:contain;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,.28));
      -webkit-user-drag: none;
      user-select:none;
      pointer-events:none;
    }

    .window{
      position:absolute;
      left:0; right:0;
      top:18px;
      height:60px;
      pointer-events:none;
    }

    .payline{
      position:absolute;
      left:10px; right:10px;
      top: 52px;
      height:2px;
      background: rgba(255,209,102,0);
      box-shadow: 0 0 0 rgba(255,209,102,0);
      transition: background .15s ease, box-shadow .15s ease;
      border-radius:999px;
      pointer-events:none;
    }
    .payline.on{
      background: rgba(255,209,102,.98);
      box-shadow: 0 0 22px rgba(255,209,102,.35);
    }

    .status{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      color:var(--muted);
      font-weight:1000;
      margin: 8px 0 10px;
      font-size:13px;
    }
    .status .win{color:var(--good); min-width: 120px; text-align:right; font-weight:1100;}

    .btnRow{display:flex; gap:10px;}
    button{
      border:0; cursor:pointer;
      border-radius:18px;
      padding:14px 14px;
      font-weight:1200;
      letter-spacing:.2px;
      width:100%;
      box-shadow: 0 18px 34px rgba(0,0,0,.40);
      transition: transform .08s ease, filter .08s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      position:relative;
    }
    button:active{transform: translateY(1px) scale(.99); filter: brightness(.98);}

    .spin{
      background:
        radial-gradient(180px 80px at 30% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(255,210,105,.98), rgba(255,114,198,.98), rgba(123,223,242,.98));
      color:#2a0637;
      border: 1px solid rgba(255,255,255,.22);
      box-shadow:
        0 18px 34px rgba(0,0,0,.40),
        inset 0 10px 18px rgba(255,255,255,.20);
    }
    .spin.pulse::before{
      content:"";
      position:absolute; inset:-6px;
      border-radius:22px;
      border:2px solid rgba(255,209,102,.55);
      animation:pulse 1.15s infinite;
    }
    @keyframes pulse{
      0%{opacity:.0; transform:scale(.98);}
      35%{opacity:.85; transform:scale(1.0);}
      100%{opacity:0; transform:scale(1.08);}
    }

    .hint{
      margin-top:10px;
      text-align:center;
      color:rgba(255,255,255,.74);
      font-weight:900;
      font-size:12px;
    }

    .footerNote{
      padding:10px 14px 12px;
      color: rgba(255,255,255,.58);
      font-size:12px;
      border-top:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
      text-align:center;
      font-weight:900;
      position:relative;
      z-index:2;
    }

    .overlay{
      position:absolute; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,.58);
      padding:14px;
      z-index:50;
    }
    .overlay.show{display:flex;}
    .modal{
      width:100%;
      border-radius:20px;
      background:
        radial-gradient(600px 240px at 50% 0%, rgba(255,255,255,.10), rgba(0,0,0,0) 55%),
        rgba(18,22,52,.92);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow);
      padding:14px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .modal h2{margin:6px 0 6px; font-size:18px; letter-spacing:.2px;}
    .modal p{margin:0 0 10px; color:var(--muted); font-weight:900; font-size:13px;}

    .choices{display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px;}
    .choice{
      padding:12px;
      border-radius:18px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      font-weight:1100;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      color:var(--text);
    }
    .choice b{color:var(--gold);}
    .choice small{color:rgba(255,255,255,.72); font-weight:900;}
    .choice:active{transform: translateY(1px) scale(.99); filter: brightness(.98);}

    .bigwin{
      font-size:28px; font-weight:1200; margin:6px 0 4px;
      color: var(--gold);
      text-shadow: 0 10px 24px rgba(255,209,102,.18);
      letter-spacing:.3px;
    }
    .mini{
      display:flex; justify-content:center; gap:8px; flex-wrap:wrap;
      color:rgba(255,255,255,.75);
      font-weight:900;
      font-size:12px;
      margin:8px 0 10px;
    }
    .tag{
      padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
    }

    .cta{
      background:
        radial-gradient(180px 90px at 30% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(81,207,102,.98), rgba(123,223,242,.98));
      color:#041a12;
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 18px 34px rgba(0,0,0,.40), inset 0 10px 18px rgba(255,255,255,.18);
    }

    /* Winner glow */
    .glow{
      box-shadow: 0 0 0 2px rgba(255,209,102,.22), 0 18px 42px rgba(255,209,102,.10);
      border-color: rgba(255,209,102,.26);
    }

    /* Particle confetti */
    .confetti{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity .15s ease;
      z-index:40;
    }
    .confetti.show{opacity:1;}
    .dot{
      position:absolute;
      width:8px; height:8px;
      border-radius:2px;
      background: rgba(255,255,255,.85);
      animation: fall 900ms ease-out forwards;
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.25));
    }
    @keyframes fall{
      0%{ transform: translateY(-20px) rotate(0deg); opacity:1; }
      100%{ transform: translateY(260px) rotate(220deg); opacity:0; }
    }
  </style>
</head>

<body>
  <div class="safe">
    <div class="card" id="card">

      <div class="confetti" id="confetti"></div>

      <div class="topbar">
        <div class="brand">
          <b id="gameName">EASYBET789</b>
          <small id="subName">‡πÅ‡∏ï‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πÄ‡∏•‡∏¢ ‚Ä¢ ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏ô‡∏ü‡∏£‡∏µ</small>
        </div>

        <div class="hud">
          <div class="pill" aria-label="coin balance">
            <span class="coin">üíµ</span>
            <span id="balance">100</span>
          </div>
          <div class="iconBtn" id="soundBtn" title="Sound">üîä</div>
        </div>
      </div>

      <div class="stage">
        <div class="hook" id="hook">üé∞ <span>FREE SPINS!</span></div>

        <div class="meterWrap">
          <div class="meterLabel">‚ú® Bonus Meter</div>
          <div class="meter" aria-label="bonus meter"><div class="meterFill" id="meterFill"></div></div>
          <div class="meterPct" id="meterPct">12%</div>
        </div>

        <div class="slot">
          <div class="payline" id="payline"></div>

          <div class="reels" id="reels">
            <div class="reel" id="reel1">
              <div class="strip" id="strip1"></div>
              <div class="window"></div>
            </div>
            <div class="reel" id="reel2">
              <div class="strip" id="strip2"></div>
              <div class="window"></div>
            </div>
            <div class="reel" id="reel3">
              <div class="strip" id="strip3"></div>
              <div class="window"></div>
            </div>
          </div>

          <div class="status">
            <div id="msg">‡πÅ‡∏ï‡∏∞ <span style="color:var(--gold);font-weight:1200;">SPIN</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç!</div>
            <div class="win" id="winText"></div>
          </div>

          <div class="btnRow">
            <button class="spin pulse" id="spinBtn">SPIN</button>
          </div>

          <div class="hint" id="hint">‡πÅ‡∏ï‡∏Å‡πÇ‡∏´‡∏î‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Ä¢ 1 ‡∏™‡∏õ‡∏¥‡∏ô‡∏ä‡∏ô‡∏∞ + ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ü‡∏£‡∏µ</div>
        </div>
      </div>

      <div class="footerNote">
        ‡∏Ñ‡∏£‡∏ö ‡∏à‡∏ö ‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
      </div>

      <!-- BONUS PICK -->
      <div class="overlay" id="bonusOverlay">
        <div class="modal">
          <h2>üéâ BONUS UNLOCKED!</h2>
          <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>

          <div class="choices">
            <button class="choice" data-bonus="freespins">
              <div style="text-align:left">
                <div><b>Free Spins x5</b></div>
                <small>‡∏ü‡∏£‡∏µ‡∏™‡∏õ‡∏¥‡∏ô 5 ‡∏£‡∏≠‡∏ö</small>
              </div>
              <div>üé∞</div>
            </button>

            <button class="choice" data-bonus="multiplier">
              <div style="text-align:left">
                <div><b>Multiplier x3</b></div>
                <small>‡∏Ñ‡∏π‡∏ì‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</small>
              </div>
              <div>‚úñÔ∏è</div>
            </button>

            <button class="choice" data-bonus="wildrush">
              <div style="text-align:left">
                <div><b>Wild Rush</b></div>
                <small>‡πÄ‡∏û‡∏¥‡πà‡∏° Wild ‡∏ä‡πà‡∏ß‡∏¢‡∏ä‡∏ô‡∏∞‡∏á‡πà‡∏≤‡∏¢</small>
              </div>
              <div>üÉè</div>
            </button>
          </div>
        </div>
      </div>

      <!-- END / CTA -->
      <div class="overlay" id="endOverlay">
        <div class="modal">
          <div class="bigwin">BIG WIN!</div>
          <p id="endCopy">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏Ñ‡∏õ‡∏£‡∏π‡∏õ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞</p>

          <div class="mini">
            <span class="tag">‡∏Ñ‡∏∑‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</span>
            <span class="tag">‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</span>
            <span class="tag">Auto24‡∏ä‡∏°</span>
          </div>

          <button class="cta" id="ctaBtn">‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
          <div style="margin-top:8px; color:rgba(255,255,255,.6); font-weight:900; font-size:12px;">
            ‡πÄ‡∏ß‡πá‡∏ö‡∏ï‡∏£‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö1
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  // =========================
  // CONFIG
  // =========================
  const CTA_URL  = "https://heylink.me/ezb789/";
  const GAME_NAME = "COIN SLOT";
  const SUB_NAME  = "Playable Demo ‚Ä¢ Social Coins";

  // ‚úÖ PNG from imgz (direct links)
  const SYMBOLS = [
    { id:"gold_l_ball",     src:"https://s.imgz.io/2026/01/16/mahjong-ways2_gold_l_ball20da51490e9e0502b.png" },
    { id:"h_blue",          src:"https://s.imgz.io/2026/01/16/mahjong-ways2_h_blueb8a3649cc331292a.png" },
    { id:"l_ball",          src:"https://s.imgz.io/2026/01/16/mahjong-ways2_l_ball2b1278fdcafa626ff.png" },
    { id:"green_h_green",   src:"https://s.imgz.io/2026/01/16/mahjong-ways2_green_h_green5c94a8272fe782ad.png" },
    { id:"h_green",         src:"https://s.imgz.io/2026/01/16/mahjong-ways2_h_green37c112c125d6241a.png" },
    { id:"gold_l_bamboo",   src:"https://s.imgz.io/2026/01/16/mahjong-ways2_gold_l_bamboo517f71254fe7087dc.png" },
    { id:"l_bamboo",        src:"https://s.imgz.io/2026/01/16/mahjong-ways2_l_bamboo5978ab1152e137595.png" },
    { id:"scatter",         src:"https://s.imgz.io/2026/01/16/mahjong-ways2_s_scattere0ca5929bf04dc35.png" },
    { id:"wild",            src:"https://s.imgz.io/2026/01/16/mahjong-ways2_s_wild_en8839bf1984f214a0.png" }
  ];

  const STRIP_LEN = 18;
  const SPIN_MS = 980;
  const STAGGER = 130;

  const WINDOW_INDEX = 1;
  const WINDOW_TOP = 18;

  const FIRST_WIN = 5000;

  // =========================
  // ELEMENTS
  // =========================
  const gameNameEl = document.getElementById("gameName");
  const subNameEl  = document.getElementById("subName");
  const balanceEl  = document.getElementById("balance");
  const meterFill  = document.getElementById("meterFill");
  const meterPct   = document.getElementById("meterPct");
  const msgEl      = document.getElementById("msg");
  const winEl      = document.getElementById("winText");
  const hookEl     = document.getElementById("hook");
  const hintEl     = document.getElementById("hint");
  const spinBtn    = document.getElementById("spinBtn");

  const bonusOverlay = document.getElementById("bonusOverlay");
  const endOverlay   = document.getElementById("endOverlay");
  const ctaBtn       = document.getElementById("ctaBtn");

  const payline = document.getElementById("payline");
  const confetti = document.getElementById("confetti");

  const strips = [
    document.getElementById("strip1"),
    document.getElementById("strip2"),
    document.getElementById("strip3"),
  ];
  const reels = [
    document.getElementById("reel1"),
    document.getElementById("reel2"),
    document.getElementById("reel3"),
  ];

  // =========================
  // STATE
  // =========================
  let balance = 15000;
  let meter = 12;
  let hasSpun = false;
  let locked = false;

  // Sound
  const soundBtn = document.getElementById("soundBtn");
  let soundOn = true;
  let audioUnlocked = false;
  let audioCtx = null;

  // =========================
  // HELPERS
  // =========================
  function format(n){ return Math.floor(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
  function setBalance(n){ balance = Math.max(0, Math.floor(n)); balanceEl.textContent = format(balance); }
  function setMeter(pct){
    meter = Math.max(0, Math.min(100, Math.floor(pct)));
    meterFill.style.width = meter + "%";
    meterPct.textContent = meter + "%";
  }
  function setMsg(text, winText=""){ msgEl.innerHTML = text; winEl.textContent = winText; }

  function randSym(){ return SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]; }
  function symById(id){ return SYMBOLS.find(s => s.id === id) || randSym(); }

  function vibrate(ms){ try{ if (navigator.vibrate) navigator.vibrate(ms); } catch(e){} }
  function track(eventName, data = {}) { console.log("[TRACK]", eventName, data); }

  // =========================
  // CLICK-THROUGH (MRAID)
  // =========================
  function clickThrough(url){
    track("cta_click", { url });
    if (window.mraid && typeof window.mraid.open === "function") {
      try { window.mraid.open(url); return; } catch(e) {}
    }
    try {
      const w = window.open(url, "_blank");
      if (!w) window.location.href = url;
    } catch(e) {
      window.location.href = url;
    }
  }

  // =========================
  // SOUND
  // =========================
  function ensureAudio(){
    if (audioUnlocked) return true;
    try{
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") audioCtx.resume();
      audioUnlocked = true;
      return true;
    } catch(e){
      soundOn = false;
      soundBtn.textContent = "üîá";
      return false;
    }
  }
  function tone(freq=440, dur=0.06, type="sine", gain=0.03){
    if (!soundOn || !audioUnlocked || !audioCtx) return;
    const t0 = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.setValueAtTime(freq, t0);
    g.gain.setValueAtTime(gain, t0);
    g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(t0); o.stop(t0 + dur);
  }
  function sfxSpin(){
    tone(220, 0.04, "triangle", 0.02);
    setTimeout(()=>tone(260, 0.05, "triangle", 0.02), 55);
    setTimeout(()=>tone(300, 0.06, "triangle", 0.02), 120);
  }
  function sfxWin(){
    tone(523, 0.07, "sine", 0.04);
    setTimeout(()=>tone(659, 0.07, "sine", 0.04), 70);
    setTimeout(()=>tone(784, 0.10, "sine", 0.04), 150);
  }
  function sfxTap(){ tone(520, 0.03, "square", 0.02); }

  soundBtn.addEventListener("click", () => {
    ensureAudio();
    soundOn = !soundOn;
    soundBtn.textContent = soundOn ? "üîä" : "üîá";
    track("toggle_sound", { on: soundOn });
    if (soundOn) sfxTap();
  });

  // =========================
  // PNG SYMBOL DOM
  // =========================
  function makeSymNode(sym){
    const d = document.createElement("div");
    d.className = "sym";

    const img = document.createElement("img");
    img.alt = sym.id;
    img.src = sym.src;
    img.decoding = "async";
    img.loading = "eager";
    img.referrerPolicy = "no-referrer";

    img.onerror = () => {
      console.log("‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", img.src);
      img.onerror = null;
      img.src = "data:image/svg+xml;utf8," + encodeURIComponent(
        `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64">
          <rect width="100%" height="100%" rx="12" fill="rgba(255,255,255,0.12)"/>
          <text x="50%" y="54%" text-anchor="middle" font-size="28">X</text>
        </svg>`
      );
    };

    d.appendChild(img);
    return d;
  }

  function setSymAt(stripEl, index, sym){
    const cell = stripEl.children[index];
    if (!cell) return;
    const img = cell.querySelector("img");
    if (!img) return;
    img.alt = sym.id;
    img.src = sym.src;
  }

  // =========================
  // REEL MATH
  // =========================
  function getStripMetrics(stripEl){
    const cs = getComputedStyle(stripEl);
    const padTop = parseFloat(cs.paddingTop) || 0;
    const gap = parseFloat(cs.gap) || 0;
    const sym = stripEl.querySelector(".sym");
    const symH = sym ? sym.getBoundingClientRect().height : 60;
    return { padTop, gap, symH, step: symH + gap };
  }

  function buildStrip(el, minLen = STRIP_LEN + 12){
    el.innerHTML = "";
    for(let i=0;i<minLen;i++){
      el.appendChild(makeSymNode(randSym()));
    }
    el.style.transform = "translateY(0px)";
  }

  // ‚úÖ easing + overshoot ‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (2 ‡πÄ‡∏ü‡∏™)
  function animateReelToIndex(i, duration, stopIndex){
    const el = strips[i];
    const m = getStripMetrics(el);
    const targetY = WINDOW_TOP - m.padTop - (m.step * stopIndex);

    const overshootPx = Math.min(16, Math.max(8, m.step * 0.18)); // 8-16px
    const jitter = (Math.random() * 4) - 2; // -2..+2
    const overY = targetY + overshootPx + jitter;

    const t1 = Math.max(140, Math.floor(duration * 0.88));
    const t2 = Math.max(90, duration - t1);

    const from = el.style.transform || "translateY(0px)";

    const a1 = el.animate(
      [{ transform: from }, { transform: `translateY(${overY}px)` }],
      { duration: t1, easing: "cubic-bezier(.10, .95, .15, 1.00)", fill: "forwards" }
    );

    return a1.finished.then(() => {
      const a2 = el.animate(
        [{ transform: `translateY(${overY}px)` }, { transform: `translateY(${targetY}px)` }],
        { duration: t2, easing: "cubic-bezier(.20, 1.20, .30, 1.00)", fill: "forwards" }
      );
      return a2.finished;
    });
  }

  async function spinToFinal(finalSyms, baseMs=SPIN_MS, turns=4){
    const stopIndex = [0,0,0];

    for(let i=0;i<3;i++){
      stopIndex[i] = WINDOW_INDEX + (STRIP_LEN * turns) + Math.floor(Math.random() * STRIP_LEN);
      buildStrip(strips[i], stopIndex[i] + 14);
      setSymAt(strips[i], stopIndex[i], finalSyms[i]);
    }

    await animateReelToIndex(0, baseMs, stopIndex[0]);
    await new Promise(r=>setTimeout(r, STAGGER));
    await animateReelToIndex(1, baseMs + 120, stopIndex[1]);
    await new Promise(r=>setTimeout(r, STAGGER));
    await animateReelToIndex(2, baseMs + 240, stopIndex[2]);
  }

  // =========================
  // UI FX
  // =========================
  function glowOn(on){ reels.forEach(r => r.classList.toggle("glow", on)); }
  function paylineOn(on){ payline.classList.toggle("on", on); }

  function burstConfetti(){
    confetti.innerHTML = "";
    const colors = [
      "rgba(255,210,105,.95)",
      "rgba(255,114,198,.95)",
      "rgba(123,223,242,.95)",
      "rgba(255,255,255,.85)"
    ];
    for(let i=0;i<26;i++){
      const d = document.createElement("div");
      d.className = "dot";
      d.style.left = (10 + Math.random()*80) + "%";
      d.style.top = (-10 - Math.random()*40) + "px";
      d.style.background = colors[Math.floor(Math.random()*colors.length)];
      d.style.animationDelay = (Math.random()*120) + "ms";
      d.style.transform = `translateY(-20px) rotate(${Math.random()*120}deg)`;
      confetti.appendChild(d);
    }
    confetti.classList.add("show");
    setTimeout(()=>confetti.classList.remove("show"), 520);
  }

  // =========================
  // PRELOAD (optional)
  // =========================
  function preloadSymbols(){
    return Promise.allSettled(
      SYMBOLS.map(s => new Promise((resolve) => {
        const img = new Image();
        img.decoding = "async";
        img.referrerPolicy = "no-referrer";
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = s.src;
      }))
    );
  }

  // =========================
  // OUTCOMES (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ)
  // =========================
  function firstSpinOutcome(){
    const a = symById("gold_l_ball");
    const b = symById("gold_l_ball");
    const c = randSym();
    return [a, b, c];
  }

  async function runBonus(type){
    if(type === "freespins"){
      hookEl.innerHTML = "üç≠ <span>FREE SPINS MODE!</span>";
      setMsg("‡∏´‡∏°‡∏∏‡∏ô‡∏ü‡∏£‡∏µ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...", "");

      for(let k=0;k<4;k++){
        sfxSpin();
        await spinToFinal([randSym(), randSym(), randSym()], 520, 2);
        await new Promise(r=>setTimeout(r, 110));
      }

      sfxSpin();
      await spinToFinal([symById("wild"), symById("scatter"), symById("wild")], 780, 3);
      return 8000;
    }

    if(type === "multiplier"){
      hookEl.innerHTML = "‚úñÔ∏è <span>MULTIPLIER x3</span>!";
      setMsg("‡∏Ñ‡∏π‡∏ì‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô...", "");
      sfxSpin();
      await spinToFinal([symById("h_blue"), symById("h_blue"), symById("h_blue")], 880, 4);
      return 9000;
    }

    hookEl.innerHTML = "üÉè <span>WILD RUSH</span>!";
    setMsg("Wild ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ä‡∏ô‡∏∞‡∏á‡πà‡∏≤‡∏¢...", "");
    sfxSpin();
    await spinToFinal([symById("wild"), symById("h_green"), symById("wild")], 920, 4);
    return 11000;
  }

  // =========================
  // FLOW
  // =========================
  async function doFirstSpin(){
    if(locked) return;
    locked = true;

    ensureAudio();
    track("tap_spin");
    spinBtn.classList.remove("pulse");
    hintEl.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô...";
    setMsg("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏´‡∏°‡∏∏‡∏ô...", "");
    paylineOn(false);
    glowOn(false);

    sfxSpin();
    vibrate(25);

    const final = firstSpinOutcome();
    await spinToFinal(final, SPIN_MS, 4);

    setBalance(balance + FIRST_WIN);
    setMsg("‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!", `+${format(FIRST_WIN)} coins`);
    setMeter(68);

    paylineOn(true);
    glowOn(true);
    burstConfetti();
    sfxWin();
    vibrate(45);

    track("first_win", { win: FIRST_WIN });
    hasSpun = true;

    await new Promise(r=>setTimeout(r, 700));
    setMsg("‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!", "");
    hintEl.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°";
    bonusOverlay.classList.add("show");
    track("bonus_unlocked");

    locked = false;
  }

  async function doBonus(type){
    if(locked) return;
    locked = true;

    ensureAudio();
    track("bonus_pick", { type });
    bonusOverlay.classList.remove("show");

    paylineOn(false);
    glowOn(false);

    const win = await runBonus(type);

    setBalance(balance + win);
    setMeter(100);
    setMsg("BIG WIN!", `+${format(win)} coins`);
    paylineOn(true);
    glowOn(true);
    burstConfetti();
    sfxWin();
    vibrate(65);

    track("bonus_win", { type, win });

    await new Promise(r=>setTimeout(r, 850));
    document.getElementById("endCopy").textContent =
      "‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏ï‡πá‡∏°";
    endOverlay.classList.add("show");
    track("show_cta");

    locked = false;
  }

  // =========================
  // EVENTS
  // =========================
  spinBtn.addEventListener("click", () => {
    if(!audioUnlocked) ensureAudio();
    if(!hasSpun) return doFirstSpin();
    if(endOverlay.classList.contains("show")) return;
  });

  bonusOverlay.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-bonus]");
    if(!btn) return;
    sfxTap();
    doBonus(btn.getAttribute("data-bonus"));
  });

  ctaBtn.addEventListener("click", () => {
    sfxTap();
    clickThrough(CTA_URL);
  });

  endOverlay.addEventListener("click", (e) => {
    if(e.target && e.target.id === "ctaBtn") return;
    clickThrough(CTA_URL);
  });

  // =========================
  // INIT
  // =========================
  gameNameEl.textContent = GAME_NAME;
  subNameEl.textContent  = SUB_NAME;
  setBalance(balance);
  setMeter(meter);

  spinBtn.disabled = true;
  spinBtn.textContent = "LOADING...";
  spinBtn.classList.remove("pulse");

  for(let i=0;i<3;i++){
    buildStrip(strips[i], STRIP_LEN + 18);
  }
  // initial symbols
  setSymAt(strips[0], 2, symById("gold_l_ball"));
  setSymAt(strips[1], 2, symById("h_blue"));
  setSymAt(strips[2], 2, symById("scatter"));

  preloadSymbols().then(() => {
    spinBtn.disabled = false;
    spinBtn.textContent = "SPIN";
    spinBtn.classList.add("pulse");
    hintEl.textContent = "‡πÄ‡∏î‡πÇ‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á ‚Ä¢ 1 ‡∏™‡∏õ‡∏¥‡∏ô‡∏ä‡∏ô‡∏∞ + ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ö‡∏ô‡∏±‡∏™";
    track("start_playable");
  });
})();
</script>
</body>
</html>
